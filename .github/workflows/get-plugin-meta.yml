name: Get Plugin Meta
on:
  workflow_call:
    outputs:
      plugin_slug:
        description: 'Plugin slug from plugin-meta.json'
        value: ${{ jobs.meta.outputs.plugin_slug }}
      distribution_platform:
        description: 'Distribution platform from plugin-meta.json'
        value: ${{ jobs.meta.outputs.distribution_platform }}
      plugin_meta_json:
        description: 'Full plugin-meta.json content (compact JSON)'
        value: ${{ jobs.meta.outputs.plugin_meta_json }}
jobs:
  meta:
    runs-on: ubuntu-latest
    outputs:
      plugin_slug: ${{ steps.read.outputs.plugin_slug }}
      distribution_platform: ${{ steps.read.outputs.distribution_platform }}
      plugin_meta_json: ${{ steps.read.outputs.plugin_meta_json }}
    steps:
      - name: Checkout plugin repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Checkout CI helpers
        uses: actions/checkout@v4
        with:
          repository: krokedil/krokedil-wp-ci
          path: .github/krokedil-wp-ci
          fetch-depth: 1

      - name: Read plugin-meta.json
        id: read
        run: bash .github/krokedil-wp-ci/scripts/get-plugin-meta.sh
